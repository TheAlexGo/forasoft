<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css" integrity="sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I" crossorigin="anonymous">
    <title>Chat-App</title>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-12 d-flex justify-content-center flex-column">
            <h1 class="text-center">
                Чат-приложение
            </h1>
            <span class="text-center text-secondary">Чтобы начать переписку, заполните своё имя и текст сообщения</span>
        </div>
    </div>
</div>

<section class="mt-5">
    <div class="container">
        <div class="row">
            <div class="col-6">
                <form id="formMes">
                    <h3>Введите ваше сообщение</h3>
                    <div class="mb-3">
                        <label for="userName" class="form-label">Имя пользователя:</label>
                        <input type="text" id="userName" class="form-control" placeholder="Имя пользователя" />
                    </div>
                    <div class="mb-3">
                        <label for="userMessage" class="form-label">Сообщение пользователя:</label>
                        <textarea id="userMessage" cols="30" rows="3" class="form-control" placeholder="Введите сообщение"></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary">Отправить</button>
                </form>
            </div>
            <div class="col-6">
                <h3>Все сообщения:</h3>
                <div id="allMessages">

                </div>
            </div>
        </div>
    </div>
</section>
<script src="/socket.io/socket.io.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => { // Когда загрузится вся страница, начать работу
    const socket = io.connect(); // Объявляем константу сокета

    const formBlock = document.querySelector('#formMes'); // Объявляем константу формы сообщения
    const userNameBlock = document.querySelector('#userName'); // Объявляем константу input имени пользователя
    const userMessageBlock = document.querySelector('#userMessage'); // Объявляем константу textarea сообщения пользователя
    const allMessagesBlock = document.querySelector('#allMessages'); // Объявляем константу блока со всеми сообщениями

    formBlock.addEventListener("submit", (event) => { // При отправке формы -> Выполнить действия
      event.preventDefault(); // Отключаем стандартный метод отправки формы

      const nowDate = new Date(); // Получаем настоящую дату
      const Hour = nowDate.getHours(); // Получаем настоящие часы
      const Minute = nowDate.getMinutes() < 10 ? '0'+nowDate.getMinutes() : nowDate.getMinutes(); // Получаем настоящие минуты

      socket.emit('send message', { // Объявляем метод при отправке сообщения
        name: userNameBlock.value, // name - имя пользователя
        message: userMessageBlock.value, // message - сообщение пользователя
        time: `${Hour}:${Minute}` // date - время, в которое было отправлено сообщение
      });

      userMessageBlock.value = ''; // Очищаем поле сообщения пользователя
    })

    socket.on("add message", (data) => { // Принимаем метод для добавления сообщения в общий блок
      const newMessage = document.createElement('div'); // Создаём константу с новым блоком сообщения
      newMessage.innerHTML = `
                <div>
                    <div>
                        <h5>${ data.name }</h5>
                    </div>
                    <div>${ data.message }</div>
                    <div>
                        <span>${ data.time }</span>
                    </div>
                </div>
                `; // шаблон блока сообщения, где data.name - имя пользователя, data.message - сообщение пользователя
      // data.date - время, в которое было отправлено сообщение
      allMessagesBlock.append(newMessage); // Добавление блока с новым сообщением в блок всех сообщений
    })

  })
</script>
</body>
</html>

